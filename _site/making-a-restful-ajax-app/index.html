<p>&lt;!<span class="caps">DOCTYPE</span> html&gt;<br />
<html><br />
<head><br />
	<title>restful ajax web app basics ( mimic gmail with backbone.js, <span class="caps">SOA</span>, <span class="caps">TSA</span> )</title><br />
	<link href="http://alexgorbatchev.com/pub/sh/current/styles/shThemeDefault.css" rel="stylesheet" type="text/css" /><br />
	<link href="http://alexgorbatchev.com/pub/sh/current/styles/shBrushJScript.css" rel="stylesheet" type="text/css" /><br />
	<link href="http://alexgorbatchev.com/pub/sh/current/styles/shBrushXml.css" rel="stylesheet" type="text/css" /><br />
	<link href="http://alexgorbatchev.com/pub/sh/current/styles/shCore.css" rel="stylesheet" type="text/css" /><br />
	<script src="http://alexgorbatchev.com/pub/sh/current/scripts/shCore.js" type="text/javascript"></script><br />
	<script src="http://alexgorbatchev.com/pub/sh/current/scripts/shAutoloader.js" type="text/javascript"></script><br />
	<script src="http://alexgorbatchev.com/pub/sh/current/scripts/shBrushJScript.js" type="text/javascript"></script><br />
	<script src="http://alexgorbatchev.com/pub/sh/current/scripts/shBrushXml.js" type="text/javascript"></script><br />
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.min.js"></script><br />
	<style type="text/css"><br />
		body, ul { padding: 0; margin: 0; }<br />
		body { font-family: &#8216;Arial&#8217;; }<br />
		#container { width: 760px; margin: auto; }<br />
		h1 {  font-size: 3em;  }<br />
		h3 { color: #444; }<br />
		#topmenu {  height: 15px; border-bottom: 1px solid #996699;	padding: 5px; }<br />
		#topmenu ul { list-style: none; }<br />
		#topmenu li { float: left; margin-left: 15px; font-size: 13px;}</p>
</style>
</head>
<body>
<p><!--Survey code for sadsa--><br />
<link rel="stylesheet" type="text/css" href="http://serve.poplytics.com/shadowbox.css"><br />
<script type='text/javascript' src='http://ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.min.js'></script><br />
<script type="text/javascript" src="http://serve.poplytics.com/shadowbox.js"></script><br />
<script language="javascript" type="text/javascript" src="http://serve.poplytics.com/js/jquery.xdomainajax.js"></script><br />
<script language="javascript" type="text/javascript">
Shadowbox.init();
$(document).ready(function()
{
$.ajax({
url: 'http://serve.poplytics.com/ads.php?uniq=148408611',
type: 'GET',
success: function(res) {
$('#poplytics').html(res.responseText);
}
});
})
</script>
<div id="poplytics"></div><br />
<!-- End Survey code for sadsa--></p>
<div id="topmenu">
<ul>
	<li><a href="../index.html">home</a></li>
	<li><a href="https://github.com/thomasdavis">my repos</a></li>
	<li><a href="/about.html">about me</a></li>
	<li><a href="http://twitter.com/?status=@iamjessicagomes,%20@neutralthoughts%20is%20a%20great%20guy,%20you%20should%20marry%20him" target="_blank" alt="will load in new window, please marry me">hot woman (<span class="caps">SFW</span>)</a></li>
	<li><a href="http://protosal.com" target="_blank">my boot-strapped startup</a></li>
</ul>
<ul style="float: right; margin-right: 15px;">
<p><li>thomas davis &#8211; <a href="http://twitter.com/neutralthoughts">follow me on twitter</a> or don&#8217;t</li></p>
</ul>
</div>
<div id="container">
<article class="blog">
		<div style="width: 450px; margin: auto; margin-top: 50px; "><img style="width: 450px;" src="images/js.jpg" /></div>
		<h2>restful ajax web app basics ( mimic gmail with backbone.js, <span class="caps">SOA</span>, <span class="caps">TSA</span> )</h2>
		<p>The goal is to build a small example of Service Oriented Architecture (<span class="caps">SOA</span>) and Thin Servier Architecture (<span class="caps">TSA</span>). We want our server to only produce raw data and never send <span class="caps">HTML</span>! ( We&#8217;re using <span class="caps">REST</span> not <span class="caps">SOAP</span>, no fighting).</p>
		<p>This is a quick guide to get you started on building a one page web app that uses hashtag events and history to allow users to navigate your site without reloading the page ever.   Don&#8217;t want to be <strong>circle</strong> jerking too hard but todays tutorial will be using Backbone.js again.		  </p>

<br />
<script type="text/javascript" src="http://www.reddit.com/static/button/button1.js"></script>
     <h2 style="margin-left: 15px;"><a href="http://thomasdavis.github.com/examples/restful-app/" target="_blank">Demo</a></h2>
     <h2 style="margin-left: 15px;"><a href="https://github.com/thomasdavis/thomasdavis.github.com/tree/master/examples/restful-app" target="_blank">Source</a></h2>
        <h3>Benefits of <span class="caps">TSA</span></h3>
		<p>Before I continue with the tutorial here are just a few pros I can think of for using a fully ajax app with a restful interface.<br />
		<ul style="margin-left: 40px;"><br />
		<li>Less <span class="caps">HTTP</span> request</li>
		<li>Minimize the size of requested pages by always requesting <span class="caps">JSON</span></li>
		<li>Lets you build ajax interfaces which are fast and responsive</li>
		<li>Request are already <span class="caps">JSON</span> so if you ever need to build an <span class="caps">API</span>, it&#8217;s straight forward</li>
		<li>Google invented #! aka the hashbang for <span class="caps">SEO</span></li>
		<li>!flash</li>
<p></ul></p><br />
		<p>I was excited the first time I wrote a fully ajax app and I hope that some of you can feel the orgasmic feeling of dynamically loaded content.   With the advent of the google <a href="http://www.seomoz.org/blog/how-to-allow-google-to-crawl-ajax-content" target="_blank">hashbang</a>, you should be able to also build your websites/blogs with pure ajax calls now while still still reaping the benefits of google rankings.  </p>	<br />
        <p>Possibly one of the funnest parts is choosing an ajax loading graphic, I always use this <a href="http://ajaxload.info/" target="_blank">site</a>.</p><br />
         <h3>Understanding the hash tag</h3><br />
		<p>Backbone.js implements two classes called Controller and History.   Using just these two classes we can construct<br />
		the entire backbone of our restful app.</p><br />
		<p>To make a fully ajax website we need to use the hashtag, which up until this point has been used predominatly for anchor tags.<br />
		   Browsers don&#8217;t trigger any page refreshes with hashtags so using Javascript we can detect when the # location changes.<br />
		   Instead of triggering the default behavior of finding an anchor, we instead load custom Javascript.</p><br />
		<p><br />
		Below is all the <span class="caps">HTML</span> we will be using today.  Also note the inclusion of underscore.js, its a depdendecy of backbone.js and brings<br />
		alot of power to the table.   I have simply set up four links that shall react accordingly and hopefully load data into our content pane div.</p><br />
		<pre class='brush: html js'><br />
			&lt;!<span class="caps">DOCTYPE</span> html&gt;<br />
			&lt;html&gt;<br />
			&lt;head&gt;<br />
				&lt;title&gt;Hide your kids, hide your wife and hide your husbands&lt;/title&gt;<br />
			&lt;/head&gt;<br />
			&lt;body&gt;</p>
<p>&lt;ul id=&quot;menu&quot;&gt;<br />
			&lt;li&gt;&lt;a href=&#8220;#animals/dog&#8221;&gt;Dogs&lt;/a&gt;&lt;/li&gt;<br />
			&lt;li&gt;&lt;a href=&#8220;#animals/cat&#8221;&gt;cats&lt;/a&gt;&lt;/li&gt;<br />
			&lt;li&gt;&lt;a href=&#8220;#shop&#8221;&gt;Shops&lt;/a&gt;&lt;/li&gt;<br />
			&lt;li&gt;&lt;a href=&#8220;#gangster&#8221;&gt;Gangsters&lt;/a&gt;&lt;/li&gt;<br />
			&lt;/ul&gt;<br />
			&lt;div id=&#8220;content-pane&#8221;&gt;No content loaded&lt;/div&gt;</p>
<p>&lt;script src=&#8220;http://ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.min.js&#8221;&gt;&lt;/script&gt;<br />
			&lt;script src=&#8220;http://ajax.cdnjs.com/ajax/libs/underscore.js/1.1.4/underscore-min.js&#8221;&gt;&lt;/script&gt;<br />
			&lt;script src=&#8220;http://ajax.cdnjs.com/ajax/libs/backbone.js/0.3.3/backbone-min.js&#8221;&gt;&lt;/script&gt;<br />
			&lt;/body&gt;<br />
			&lt;/html&gt;</p>
</pre>
      <p>For those of you who are lazy the full example can be viewed <a href="http://thomasdavis.github.com/examples/restful-app/" target="_blank">here</a> and downloaded <a href="https://github.com/thomasdavis/thomasdavis.github.com/tree/master/examples/restful-app" target="_blank">here</a></p>
		<h3>Controlling the Controller</h3>
		<p>Below is the documented code that will run the restful ajax app.  Note that I have included a service called <a href="http://openkeyval.org" target="_blank">openkeyval.org</a> which is simply<br />
		a free service for storing key pair values.  It is a great example of <a href="http://www.slideshare.net/spacemonkeylabs/thin-server-architecture" target="_blank"><span class="caps">TSA</span></a> and saves me setting up a nginx/reddis server.		</p><p>Hopefully the code below should be simply enough to understand.   Most of you who have used a server side framework have probably experienced using Routes.  Backbone.js implements <br />
        routes and you should quickly read the documentation <a href="http://documentcloud.github.com/backbone/#Controller-routes" target="_blank">here</a>.   In the example I set up two types of routes<br />
        one to catch specific urls and a standard catch all urls route.   Take note of the colon and asterisk, the appended string gets turned into a variable for convenient usage in your call back functions.        </p>
        <p>Using jQuery ajax call we specify the data type as &#8220;jsonp&#8221; to circumvent the foreign cross site policy.</p>
<pre class='brush: js'>
<p>(function ($) {</p>
var restfulApp = Backbone.Controller.extend({
restfulUrl: &#8220;http://api.openkeyval.org/&#8221;, //This is a free service to store key pair values

//Routes tell the app what to do
routes: {
&#8220;animals/:animal&#8221;:          &#8220;animalAction&#8221;,  //This matches app/animals/* and assigns * to a variable called &#8220;animal&#8221;
&#8220;*page&#8221;:                 	&#8220;defaultAction&#8221;, //This simply matches any urls that weren&#8217;t caught above and assigns it to &#8220;page&#8221;
},

defaultAction: function( page ){
if( page ) {
//Once the default action is called we want to construct a link to our restful service
var restfulPageUrl = this.restfulUrl + page + &#8220;page&#8221; //http://api.openkeyval.org/gangsterpage
//Now we have a url lets get the data
this.loadRestfulData( restfulPageUrl );
}
},
animalAction: function( animal ) {
//O
<br />
<script type="text/javascript" src="http://www.reddit.com/static/button/button1.js"></script>nce the default action is called we want to construct a link to our restful service
var restfulPageUrl = this.restfulUrl + animal + &#8220;page&#8221; //http://api.openkeyval.org/dogpage
//Now we have a url lets get the data
this.loadRestfulData( restfulPageUrl );
},
loadRestfulData: function( pageUrl ){
//Set the content pane to a loading screen
$(&#8220;#content-pane&#8221;).text( &#8220;loading data&#8230;&#8221; );
//Load the data in using jQuerys ajax call
$.ajax({
url: pageUrl,
dataType: &#8220;jsonp&#8221;,
success: function(data){
//Once we receive the data, set it to the content pane.
$(&#8220;#content-pane&#8221;).text( data );
}
});
}
<p>var app = new restfulApp;<br />
				//Initiate a new history and controller class<br />
				Backbone.emulateHTTP = true;<br />
				Backbone.emulateJSON = true <br />
				Backbone.history.start();</p>
})(jQuery);
</pre>
<br />
<script type="text/javascript" src="http://www.reddit.com/static/button/button1.js"></script>
     <h2 style="margin-left: 15px;"><a href="http://thomasdavis.github.com/examples/restful-app/" target="_blank">Demo</a></h2>
     <h2 style="margin-left: 15px;"><a href="https://github.com/thomasdavis/thomasdavis.github.com/tree/master/examples/restful-app" target="_blank">Source</a></h2>
	<h3>Conclusion</h3>
<p>
Building fully ajax web apps/sites has never been easier.   I cannot think of any reasons not to and I personally love the feel of a responsive non refreshing page.   If you have built a hash tag web app or site before I&#8217;d love to see it so post it below.
</p>
         <p>If you see any errors or bad practises please do a pull request or simply leave a comment.</p>
        <p>For the last example tutorial I wrote many members of the community proposed solutions in other JS frameworks.  I believe this is very important as the web starts releasing more and more Javascript frameworks.</p>
<p><span class="st_twitter_vcount" displayText="Tweet"></span><span class="st_facebook_vcount" displayText="Share"></span><span class="st_email_vcount" displayText="Email"></span><span class="st_sharethis_vcount" displayText="Share"></span><br />
<script type="text/javascript" src="http://w.sharethis.com/button/buttons.js"></script><script type="text/javascript">stLight.options({publisher:'bdee6d8c-ed9a-4867-90f6-011704c29ee3'});</script>	</article></p>
<p><script type="text/javascript">
		SyntaxHighlighter.all()
	</script>
<script>
var idcomments_acct = 'e6c0e0096f8106ea52c674a85b26ecf9';
var idcomments_post_id = "restfulapp";
var idcomments_post_url;
</script>
<span id="IDCommentsPostTitle" style="display:none"></span><br />
<script type='text/javascript' src='http://www.intensedebate.com/js/genericCommentWrapperV2.js'></script></p>
</div>
<script src="http://static.getclicky.com/js" type="text/javascript"></script><script type="text/javascript">try{ clicky.init(66379121); }catch(err){}</script><noscript><p><img alt="Clicky" width="1" height="1" src="http://in.getclicky.com/66379121ns.gif" /></p></noscript>
<script type="text/javascript">
document.write(unescape("%3Cscript src='" + ((document.location.protocol=="https:")?"https:":"http:") + "//snapabug.appspot.com/snapabug.js' type='text/javascript'%3E%3C/script%3E"));</script><script type="text/javascript">
SnapABug.addButton('d2559443-bb0f-4ab8-80cc-3ebc411945e6',"0","55%");
</script></body>
</html>